import{a as f}from"./axios-c0bebe37.js";import{_ as A,r as i,o as w,c as B,f as e,g as o,h as a,t as _,a as r,k as N,j as V}from"./index-d39f5865.js";const x={data(){return{doc_api:"http://127.0.0.1:8000/dmsAPi/document/1",document:{},forder_api:"http://127.0.0.1:8000/dmsAPi/folder/",forderList:[],file_api:"http://127.0.0.1:8000/dmsAPi/uploadFile/",filelist:[],selected_filelist:[],document_id:0,forder_id:0,defaultProps:{children:"children",label:"folder_name"},path:"",dataList:[],fileData:{create_by:localStorage.username,update_by:localStorage.username,type:2,note:"note",document:1,folder:5},headerObj:{Authorization:"Token "+localStorage.token},previewPath:"",previewVisible:!1}},created(){this.getDocument(),this.getForderList(),this.getFileList()},methods:{getDocument(){f({url:this.doc_api,method:"get",headers:{Authorization:"Token "+localStorage.token}}).then(t=>{this.document=t.data,this.document_id=this.document.id,this.fileData.document=this.document.id}).catch(t=>{})},getForderList(){f({url:this.forder_api,method:"get",headers:{Authorization:"Token "+localStorage.token}}).then(t=>{let s=t.data.results.filter(n=>n.p_id==0);s.forEach(n=>{n.children=t.data.results.filter(m=>m.p_id==n.id)}),this.forderList=s}).catch(t=>{})},getFileList(){f({url:this.file_api,method:"get",headers:{Authorization:"Token "+localStorage.token}}).then(t=>{this.filelist=t.data.results}).catch(t=>{})},handleNodeClick(t){this.fileData.folder=t.id,this.forder_id=t.id,this.path=t.folder_name;let s="";this.forderList.forEach(n=>{t.p_id==n.id&&(s=n.folder_name+"/")}),this.selected_filelist=this.filelist.filter(n=>n.folder==this.forder_id&&n.document==this.document_id),s==""?this.path="/"+t.folder_name:this.path="/"+s+"/"+t.folder_name},submitUpload(){this.$refs.upload.submit()},onchange(t,s){console.log(t),this.fileData.file_name=t.name,this.fileData.size=t.size},onSuccess(){this.$message.success("uploaded successfully")}}},P={class:"grid-content bg-purple"},F={class:"grid-content bg-purple-light"},U=r("i",{class:"el-icon-upload"},null,-1),I=r("div",{class:"el-upload__text"},[a("Drop file here or "),r("em",null,"click to upload")],-1),T=["href"];function j(t,s,n,m,l,p){const d=i("el-descriptions-item"),y=i("el-tag"),g=i("el-descriptions"),v=i("el-tree"),b=i("el-col"),D=i("el-upload"),C=i("el-input"),h=i("el-button"),c=i("el-table-column"),z=i("el-table"),L=i("el-row"),S=i("el-card");return w(),B("div",null,[e(S,null,{default:o(()=>[e(L,null,{default:o(()=>[e(b,{span:10},{default:o(()=>[e(g,{title:"Document"},{default:o(()=>[e(d,{label:"DocumentID"},{default:o(()=>[a(_(l.document.documentID),1)]),_:1}),e(d,{label:"Version"},{default:o(()=>[a("v"+_(l.document.version),1)]),_:1}),e(d,{label:"Letze Update"},{default:o(()=>[a(_(l.document.update_time),1)]),_:1}),e(d,{label:"Bearbeiter"},{default:o(()=>[a(_(l.document.create_by),1)]),_:1}),e(d,{label:"Status"},{default:o(()=>[e(y,{size:"small",type:"warning"},{default:o(()=>[a("Bearbeitung")]),_:1})]),_:1}),e(d,{label:"Notiz"},{default:o(()=>[a(_(l.document.note),1)]),_:1})]),_:1}),r("div",P,[e(v,{data:l.forderList,accordion:"",onNodeClick:p.handleNodeClick,props:l.defaultProps},null,8,["data","onNodeClick","props"])])]),_:1}),e(b,{span:14},{default:o(()=>[e(g,{title:"File"},{default:o(()=>[e(d,{label:"the selected path"},{default:o(()=>[a(_(l.path),1)]),_:1})]),_:1}),r("div",F,[r("div",null,[e(D,{ref:"upload",drag:"",class:"upload-demo",name:"upload",action:"http://127.0.0.1:8000/dmsAPi/uploadFile/",headers:l.headerObj,data:l.fileData,"auto-upload":!1,"on-success":p.onSuccess,"on-preview":t.imgPreview,"on-change":p.onchange,style:{padding:"30px"}},{default:o(()=>[U,I]),_:1},8,["headers","data","on-success","on-preview","on-change"]),e(C,{modelValue:l.fileData.note,"onUpdate:modelValue":s[0]||(s[0]=u=>l.fileData.note=u),type:"textarea"},null,8,["modelValue"]),e(h,{style:{"margin-left":"800px"},type:"success",onClick:p.submitUpload},{default:o(()=>[a("Upload ")]),_:1},8,["onClick"]),l.path!=""?(w(),N(z,{key:0,data:l.selected_filelist,style:{width:"100%"}},{default:o(()=>[e(c,{fixed:"",prop:"file_name",label:"file_name",width:"350"}),e(c,{prop:"version",label:"version",width:"150"}),e(c,{prop:"note",label:"note",width:"350"}),e(c,{prop:"create_by",label:"create_by",width:"120"}),e(c,{prop:"update_by",label:"update_by",width:"100"}),e(c,{fixed:"right",label:"Operations",width:"360"},{default:o(u=>[r("a",{href:u.row.upload,target:"view_window"},[e(h,{type:"success",size:"mini",onClick:k=>t.removeuserById(u.row.id)},{default:o(()=>[a(" Ansehen")]),_:2},1032,["onClick"])],8,T),e(h,{type:"primary",size:"mini",onClick:k=>t.removeuserById(u.row.id)},{default:o(()=>[a(" Download")]),_:2},1032,["onClick"]),e(h,{type:"danger",size:"mini",onClick:k=>t.removeuserById(u.row.id)},{default:o(()=>[a(" Delete")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])):V("",!0)])])]),_:1})]),_:1})]),_:1})])}const q=A(x,[["render",j]]);export{q as default};
